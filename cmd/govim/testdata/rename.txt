# Test that renaming of identifiers works

vim ex 'e main.go'
errlogmatch -wait 30s 'PublishDiagnostics callback: &protocol.PublishDiagnosticsParams{\n\S+:\s+URI:\s+"file://'$WORK/main.go
vim ex 'call cursor(6,7)'

# Test pressing <Esc> key while input prompt is still showing with no input value
vim ex 'call feedkeys(\":GOVIMRename\\<CR>\\<ESC>\")'
errlogmatch -wait 1s 'rename: user cancelled or supplied an empty new name: i'

# Test pressing <Esc> key while input prompt is still showing with input value
vim ex 'call feedkeys(\":GOVIMRename\\<CR>\\<BS>banana\\<ESC>\")'
# errlogmatch -wait 1s 'rename: user cancelled or supplied an empty new name: ibanana'

# vim ex 'call execute(\"GOVIMRename banana\")'
vim ex 'silent noautocmd wall'
vim -indent call execute '["ls"]'

cmp main.go main.go.banana
cmp other.go other.go.banana

-- go.mod --
module mod.com

-- main.go --
package main

var i int

func main() {
	i += i + 5
	fmt.Printf("i: %v\n", i)
}
-- main.go.banana --
package main

var banana int

func main() {
	banana += banana + 5
	fmt.Printf("i: %v\n", banana)
}
-- other.go --
package main

func DoIt() {
	i = 6 + i
}
-- other.go.banana --
package main

func DoIt() {
	banana = 6 + banana
}
